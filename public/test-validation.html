<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Valida√ß√£o - hasValidData</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Valida√ß√£o - hasValidData()</h1>
        <p>Este teste replica exatamente a l√≥gica da fun√ß√£o hasValidData() do TemplateSelector.tsx</p>
        
        <button onclick="runTest()">üîÑ Executar Teste</button>
        <button onclick="clearData()">üóëÔ∏è Limpar Dados</button>
        <button onclick="addTestData()">üìù Adicionar Dados de Teste</button>
        <button onclick="addMinimalData()">üìù Dados M√≠nimos (s√≥ nome)</button>
        <button onclick="addObjectiveOnly()">üìù S√≥ Objetivo</button>
        
        <div id="testResults"></div>
        
        <div class="test-section">
            <h3>üìä Dados Atuais no localStorage:</h3>
            <pre id="currentData"></pre>
        </div>
    </div>

    <script>
        // Replica exata da fun√ß√£o hasValidData() do TemplateSelector.tsx
        function hasValidData() {
            console.log('üîç VALIDA√á√ÉO DE DADOS - Verificando dados v√°lidos...');
            
            // Primeiro verificar no context (simulado como vazio)
            const curriculumStateData = null; // Simulando context vazio
            console.log('üìã Context data:', curriculumStateData);
            if (curriculumStateData?.personalInfo?.name && curriculumStateData.personalInfo.name.trim() !== '') {
                console.log('‚úÖ Dados encontrados no context');
                return { result: true, source: 'context' };
            }
            
            // Se n√£o, verificar no localStorage
            try {
                const personalInfoLS = localStorage.getItem('cvgratis-curriculum');
                console.log('üíæ localStorage data:', personalInfoLS);
                
                if (personalInfoLS) {
                    const parsedData = JSON.parse(personalInfoLS);
                    console.log('üìä Parsed data:', parsedData);
                    
                    // Verificar se h√° dados pessoais com nome preenchido
                    const hasPersonalInfo = parsedData && 
                        parsedData.personalInfo && 
                        parsedData.personalInfo.name && 
                        parsedData.personalInfo.name.trim() !== '';
                    console.log('üë§ Personal info check:', hasPersonalInfo);
                    
                    if (hasPersonalInfo) {
                        console.log('‚úÖ Dados encontrados no localStorage');
                        return { result: true, source: 'localStorage-personalInfo', data: parsedData.personalInfo };
                    }
                    
                    // Verificar se h√° pelo menos algum dado preenchido (fallback mais flex√≠vel)
                    const hasAnyData = parsedData && (
                        (parsedData.personalInfo && Object.keys(parsedData.personalInfo).some(key => {
                            const value = parsedData.personalInfo[key];
                            return value && typeof value === 'string' && value.trim() !== '';
                        })) ||
                        (parsedData.objective && parsedData.objective.description && parsedData.objective.description.trim() !== '') ||
                        (parsedData.experience && Array.isArray(parsedData.experience) && parsedData.experience.length > 0) ||
                        (parsedData.education && Array.isArray(parsedData.education) && parsedData.education.length > 0) ||
                        (parsedData.skills && Array.isArray(parsedData.skills) && parsedData.skills.length > 0)
                    );
                    
                    console.log('üìù Any data check:', hasAnyData);
                    
                    if (hasAnyData) {
                        console.log('‚úÖ Dados parciais encontrados - permitindo acesso');
                        return { result: true, source: 'localStorage-anyData', data: parsedData };
                    }
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erro ao verificar localStorage:', error);
                return { result: false, source: 'error', error: error.message };
            }
            
            console.log('‚ùå Nenhum dado v√°lido encontrado');
            return { result: false, source: 'no-data' };
        }
        
        function runTest() {
            const resultsDiv = document.getElementById('testResults');
            const currentDataDiv = document.getElementById('currentData');
            
            // Mostrar dados atuais
            const currentData = localStorage.getItem('cvgratis-curriculum');
            currentDataDiv.textContent = currentData || 'Nenhum dado encontrado';
            
            // Executar teste
            console.clear();
            console.log('üß™ INICIANDO TESTE DE VALIDA√á√ÉO');
            
            const testResult = hasValidData();
            
            let html = '<div class="step"><h3>üß™ Resultado do Teste</h3>';
            
            if (testResult.result) {
                html += '<div class="result pass">‚úÖ VALIDA√á√ÉO PASSOU</div>';
                html += `<p><strong>Fonte:</strong> ${testResult.source}</p>`;
                if (testResult.data) {
                    html += '<p><strong>Dados encontrados:</strong></p>';
                    html += '<pre>' + JSON.stringify(testResult.data, null, 2) + '</pre>';
                }
            } else {
                html += '<div class="result fail">‚ùå VALIDA√á√ÉO FALHOU</div>';
                html += `<p><strong>Motivo:</strong> ${testResult.source}</p>`;
                if (testResult.error) {
                    html += `<p><strong>Erro:</strong> ${testResult.error}</p>`;
                }
            }
            
            html += '</div>';
            
            // An√°lise detalhada
            if (currentData) {
                try {
                    const parsed = JSON.parse(currentData);
                    html += '<div class="step"><h3>üîç An√°lise Detalhada</h3>';
                    
                    // Verificar cada campo
                    html += '<h4>üë§ Dados Pessoais:</h4>';
                    if (parsed.personalInfo) {
                        Object.keys(parsed.personalInfo).forEach(key => {
                            const value = parsed.personalInfo[key];
                            const isValid = value && typeof value === 'string' && value.trim() !== '';
                            html += `<p>‚Ä¢ ${key}: "${value}" ${isValid ? '‚úÖ' : '‚ùå'}</p>`;
                        });
                    } else {
                        html += '<p>‚ùå Nenhum dado pessoal encontrado</p>';
                    }
                    
                    html += '<h4>üéØ Objetivo:</h4>';
                    if (parsed.objective && parsed.objective.description) {
                        const isValid = parsed.objective.description.trim() !== '';
                        html += `<p>‚Ä¢ description: "${parsed.objective.description}" ${isValid ? '‚úÖ' : '‚ùå'}</p>`;
                    } else {
                        html += '<p>‚ùå Nenhum objetivo encontrado</p>';
                    }
                    
                    html += '<h4>üìö Outras Se√ß√µes:</h4>';
                    ['experience', 'education', 'skills'].forEach(section => {
                        if (parsed[section] && Array.isArray(parsed[section])) {
                            const count = parsed[section].length;
                            html += `<p>‚Ä¢ ${section}: ${count} items ${count > 0 ? '‚úÖ' : '‚ùå'}</p>`;
                        } else {
                            html += `<p>‚Ä¢ ${section}: n√£o √© array ‚ùå</p>`;
                        }
                    });
                    
                    html += '</div>';
                } catch (e) {
                    html += '<div class="result fail">‚ùå Erro ao analisar dados: ' + e.message + '</div>';
                }
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function clearData() {
            localStorage.removeItem('cvgratis-curriculum');
            alert('Dados limpos!');
            runTest();
        }
        
        function addTestData() {
            const testData = {
                personalInfo: {
                    name: 'Ana Victoria Reis',
                    email: 'avreis@gmail.com',
                    phone: '31995652414',
                    address: 'Belo Horizonte, MG',
                    linkedin: '',
                    website: ''
                },
                objective: {
                    description: 'Especialista em administrativo com comprovada expertise em controle, finan√ßas.',
                    keywords: ''
                },
                experience: [],
                education: [],
                skills: [],
                languages: [],
                courses: [],
                projects: [],
                achievements: []
            };
            
            localStorage.setItem('cvgratis-curriculum', JSON.stringify(testData));
            alert('Dados completos adicionados!');
            runTest();
        }
        
        function addMinimalData() {
            const minimalData = {
                personalInfo: {
                    name: 'Jo√£o Silva',
                    email: '',
                    phone: '',
                    address: '',
                    linkedin: '',
                    website: ''
                }
            };
            
            localStorage.setItem('cvgratis-curriculum', JSON.stringify(minimalData));
            alert('Dados m√≠nimos (s√≥ nome) adicionados!');
            runTest();
        }
        
        function addObjectiveOnly() {
            const objectiveData = {
                personalInfo: {
                    name: '',
                    email: '',
                    phone: '',
                    address: '',
                    linkedin: '',
                    website: ''
                },
                objective: {
                    description: 'Busco uma oportunidade na √°rea de tecnologia.',
                    keywords: ''
                }
            };
            
            localStorage.setItem('cvgratis-curriculum', JSON.stringify(objectiveData));
            alert('Dados com objetivo preenchido adicionados!');
            runTest();
        }
        
        // Executar teste automaticamente ao carregar
        window.onload = function() {
            runTest();
        };
    </script>
</body>
</html>