<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Valida√ß√£o - Teste de Corre√ß√£o</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug Valida√ß√£o - Teste de Corre√ß√£o</h1>
        <p>Este arquivo testa e corrige problemas de valida√ß√£o de dados do curr√≠culo.</p>
        
        <div class="test-section">
            <h3>üìã Status Atual dos Dados</h3>
            <button onclick="checkCurrentData()">Verificar Dados Atuais</button>
            <div id="currentDataResult"></div>
        </div>
        
        <div class="test-section">
            <h3>üîß Corrigir Dados Corrompidos</h3>
            <button onclick="fixCorruptedData()">Corrigir Dados</button>
            <div id="fixResult"></div>
        </div>
        
        <div class="test-section">
            <h3>‚úÖ Testar Valida√ß√£o</h3>
            <button onclick="testValidation()">Testar Valida√ß√£o</button>
            <div id="validationResult"></div>
        </div>
        
        <div class="test-section">
            <h3>üóëÔ∏è Limpar Dados (Reset)</h3>
            <button onclick="clearAllData()" style="background: #dc3545;">Limpar Tudo</button>
            <div id="clearResult"></div>
        </div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'warning';
            element.innerHTML = `<div class="${className}"><pre>${message}</pre></div>`;
        }

        function checkCurrentData() {
            try {
                const curriculumData = localStorage.getItem('cvgratis-curriculum');
                const templateData = localStorage.getItem('cvgratis-selected-template');
                const premiumData = localStorage.getItem('cvgratis-premium-unlocked');
                
                let result = 'üìä DADOS ENCONTRADOS:\n\n';
                
                if (curriculumData) {
                    try {
                        const parsed = JSON.parse(curriculumData);
                        result += '‚úÖ cvgratis-curriculum: V√ÅLIDO\n';
                        result += `   - Tamanho: ${curriculumData.length} caracteres\n`;
                        result += `   - Dados pessoais: ${parsed.personalInfo ? 'SIM' : 'N√ÉO'}\n`;
                        if (parsed.personalInfo) {
                            result += `   - Nome: ${parsed.personalInfo.name || 'VAZIO'}\n`;
                            result += `   - Email: ${parsed.personalInfo.email || 'VAZIO'}\n`;
                        }
                        result += `   - Objetivo: ${parsed.objective ? 'SIM' : 'N√ÉO'}\n`;
                        result += `   - Experi√™ncia: ${parsed.experience ? parsed.experience.length + ' itens' : 'N√ÉO'}\n`;
                        result += `   - Educa√ß√£o: ${parsed.education ? parsed.education.length + ' itens' : 'N√ÉO'}\n`;
                    } catch (e) {
                        result += '‚ùå cvgratis-curriculum: CORROMPIDO\n';
                        result += `   - Erro: ${e.message}\n`;
                    }
                } else {
                    result += '‚ö†Ô∏è cvgratis-curriculum: N√ÉO ENCONTRADO\n';
                }
                
                result += `\nüìã Template selecionado: ${templateData || 'NENHUM'}\n`;
                result += `üèÜ Premium desbloqueado: ${premiumData || 'N√ÉO'}\n`;
                
                log('currentDataResult', result, 'success');
            } catch (error) {
                log('currentDataResult', `‚ùå Erro ao verificar dados: ${error.message}`, 'error');
            }
        }

        function fixCorruptedData() {
            try {
                let result = 'üîß CORRIGINDO DADOS...\n\n';
                
                // Verificar e corrigir dados do curr√≠culo
                const curriculumData = localStorage.getItem('cvgratis-curriculum');
                if (curriculumData) {
                    try {
                        const parsed = JSON.parse(curriculumData);
                        
                        // Garantir estrutura m√≠nima
                        const fixedData = {
                            personalInfo: {
                                name: '',
                                email: '',
                                phone: '',
                                whatsapp: '',
                                address: '',
                                photo: '',
                                isRoundPhoto: true,
                                hasDriverLicense: false,
                                driverLicenseCategories: [],
                                ...parsed.personalInfo
                            },
                            objective: {
                                keywords: '',
                                description: '',
                                ...parsed.objective
                            },
                            experience: parsed.experience || [],
                            education: parsed.education || [],
                            skills: parsed.skills || [],
                            languages: parsed.languages || [],
                            courses: parsed.courses || [],
                            projects: parsed.projects || [],
                            achievements: parsed.achievements || []
                        };
                        
                        localStorage.setItem('cvgratis-curriculum', JSON.stringify(fixedData));
                        result += '‚úÖ Dados do curr√≠culo corrigidos\n';
                        
                    } catch (e) {
                        // Dados completamente corrompidos - criar novos
                        const newData = {
                            personalInfo: {
                                name: '',
                                email: '',
                                phone: '',
                                whatsapp: '',
                                address: '',
                                photo: '',
                                isRoundPhoto: true,
                                hasDriverLicense: false,
                                driverLicenseCategories: []
                            },
                            objective: {
                                keywords: '',
                                description: ''
                            },
                            experience: [],
                            education: [],
                            skills: [],
                            languages: [],
                            courses: [],
                            projects: [],
                            achievements: []
                        };
                        
                        localStorage.setItem('cvgratis-curriculum', JSON.stringify(newData));
                        result += 'üÜï Dados corrompidos substitu√≠dos por estrutura limpa\n';
                    }
                } else {
                    result += '‚ö†Ô∏è Nenhum dado encontrado para corrigir\n';
                }
                
                // Verificar template
                const templateData = localStorage.getItem('cvgratis-selected-template');
                if (!templateData) {
                    localStorage.setItem('cvgratis-selected-template', 'free-modern');
                    result += '‚úÖ Template padr√£o definido\n';
                }
                
                result += '\nüéØ CORRE√á√ÉO CONCLU√çDA!';
                log('fixResult', result, 'success');
                
            } catch (error) {
                log('fixResult', `‚ùå Erro ao corrigir dados: ${error.message}`, 'error');
            }
        }

        function testValidation() {
            try {
                let result = 'üß™ TESTANDO VALIDA√á√ÉO...\n\n';
                
                const curriculumData = localStorage.getItem('cvgratis-curriculum');
                if (!curriculumData) {
                    result += '‚ùå Nenhum dado encontrado\n';
                    log('validationResult', result, 'error');
                    return;
                }
                
                const parsed = JSON.parse(curriculumData);
                
                // Teste 1: Dados pessoais
                const hasPersonalInfo = parsed.personalInfo && 
                    parsed.personalInfo.name && 
                    parsed.personalInfo.name.trim() !== '';
                result += `üìã Dados pessoais: ${hasPersonalInfo ? '‚úÖ V√ÅLIDO' : '‚ùå INV√ÅLIDO'}\n`;
                
                // Teste 2: Pelo menos algum dado preenchido
                const hasAnyData = (
                    (parsed.personalInfo && Object.keys(parsed.personalInfo).some(key => {
                        const value = parsed.personalInfo[key];
                        return value && typeof value === 'string' && value.trim() !== '';
                    })) ||
                    (parsed.objective && parsed.objective.description && parsed.objective.description.trim() !== '') ||
                    (parsed.experience && Array.isArray(parsed.experience) && parsed.experience.length > 0) ||
                    (parsed.education && Array.isArray(parsed.education) && parsed.education.length > 0) ||
                    (parsed.skills && Array.isArray(parsed.skills) && parsed.skills.length > 0)
                );
                result += `üìù Algum dado preenchido: ${hasAnyData ? '‚úÖ V√ÅLIDO' : '‚ùå INV√ÅLIDO'}\n`;
                
                // Teste 3: Estrutura JSON
                result += `üîß JSON v√°lido: ‚úÖ V√ÅLIDO\n`;
                
                // Resultado final
                const isValid = hasPersonalInfo || hasAnyData;
                result += `\nüéØ RESULTADO FINAL: ${isValid ? '‚úÖ APROVADO' : '‚ùå REPROVADO'}\n`;
                
                if (isValid) {
                    result += '\n‚úÖ O usu√°rio DEVERIA conseguir acessar o template-selector';
                } else {
                    result += '\n‚ùå O usu√°rio N√ÉO deveria conseguir acessar o template-selector';
                }
                
                log('validationResult', result, isValid ? 'success' : 'error');
                
            } catch (error) {
                log('validationResult', `‚ùå Erro na valida√ß√£o: ${error.message}`, 'error');
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja limpar TODOS os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                try {
                    localStorage.removeItem('cvgratis-curriculum');
                    localStorage.removeItem('cvgratis-selected-template');
                    localStorage.removeItem('cvgratis-premium-unlocked');
                    localStorage.removeItem('cv-user-data');
                    localStorage.removeItem('selected-premium-template');
                    
                    log('clearResult', '‚úÖ Todos os dados foram limpos com sucesso!\n\nVoc√™ pode agora testar o fluxo do zero.', 'success');
                } catch (error) {
                    log('clearResult', `‚ùå Erro ao limpar dados: ${error.message}`, 'error');
                }
            }
        }

        // Executar verifica√ß√£o inicial
        window.onload = function() {
            checkCurrentData();
        };
    </script>
</body>
</html>