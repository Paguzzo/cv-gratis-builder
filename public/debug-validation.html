<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Valida√ß√£o de Dados</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .data-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .validation-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .valid {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .invalid {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug - Valida√ß√£o de Dados do Curr√≠culo</h1>
        
        <button onclick="checkValidation()">üîÑ Verificar Valida√ß√£o</button>
        <button onclick="clearData()">üóëÔ∏è Limpar Dados</button>
        <button onclick="populateTestData()">üìù Popular Dados de Teste</button>
        
        <div id="validationResult"></div>
        
        <div class="data-section">
            <h3>üìä Dados do localStorage (cvgratis-curriculum):</h3>
            <pre id="localStorageData"></pre>
        </div>
        
        <div class="data-section">
            <h3>üîç An√°lise Detalhada:</h3>
            <div id="detailedAnalysis"></div>
        </div>
    </div>

    <script>
        function checkValidation() {
            console.log('üîç VALIDA√á√ÉO DE DADOS - Verificando dados v√°lidos...');
            
            const resultDiv = document.getElementById('validationResult');
            const dataDiv = document.getElementById('localStorageData');
            const analysisDiv = document.getElementById('detailedAnalysis');
            
            try {
                const personalInfoLS = localStorage.getItem('cvgratis-curriculum');
                console.log('üíæ localStorage data:', personalInfoLS);
                
                dataDiv.textContent = personalInfoLS || 'Nenhum dado encontrado';
                
                if (personalInfoLS) {
                    const parsedData = JSON.parse(personalInfoLS);
                    console.log('üìä Parsed data:', parsedData);
                    
                    let analysis = '';
                    
                    // Verificar se h√° dados pessoais com nome preenchido
                    const hasPersonalInfo = parsedData && 
                        parsedData.personalInfo && 
                        parsedData.personalInfo.name && 
                        parsedData.personalInfo.name.trim() !== '';
                    
                    analysis += `üë§ Personal Info Check: ${hasPersonalInfo ? '‚úÖ V√ÅLIDO' : '‚ùå INV√ÅLIDO'}\n`;
                    analysis += `   - personalInfo existe: ${!!parsedData.personalInfo}\n`;
                    analysis += `   - name existe: ${!!parsedData.personalInfo?.name}\n`;
                    analysis += `   - name n√£o vazio: ${parsedData.personalInfo?.name?.trim() !== ''}\n`;
                    analysis += `   - valor do name: "${parsedData.personalInfo?.name || 'undefined'}"\n\n`;
                    
                    if (hasPersonalInfo) {
                        resultDiv.innerHTML = '<div class="validation-result valid">‚úÖ VALIDA√á√ÉO PASSOU - Dados v√°lidos encontrados!</div>';
                        analysis += 'üéâ RESULTADO: Valida√ß√£o deveria PASSAR\n';
                    } else {
                        // Verificar se h√° pelo menos algum dado preenchido (fallback mais flex√≠vel)
                        const hasAnyData = parsedData && (
                            (parsedData.personalInfo && Object.keys(parsedData.personalInfo).some(key => {
                                const value = parsedData.personalInfo[key];
                                return value && typeof value === 'string' && value.trim() !== '';
                            })) ||
                            (parsedData.objective && parsedData.objective.description && parsedData.objective.description.trim() !== '') ||
                            (parsedData.experience && Array.isArray(parsedData.experience) && parsedData.experience.length > 0) ||
                            (parsedData.education && Array.isArray(parsedData.education) && parsedData.education.length > 0) ||
                            (parsedData.skills && Array.isArray(parsedData.skills) && parsedData.skills.length > 0)
                        );
                        
                        analysis += `üìù Any Data Check: ${hasAnyData ? '‚úÖ V√ÅLIDO' : '‚ùå INV√ÅLIDO'}\n`;
                        
                        if (parsedData.personalInfo) {
                            analysis += '   - Campos personalInfo:\n';
                            Object.keys(parsedData.personalInfo).forEach(key => {
                                const value = parsedData.personalInfo[key];
                                const isValid = value && typeof value === 'string' && value.trim() !== '';
                                analysis += `     * ${key}: "${value}" ${isValid ? '‚úÖ' : '‚ùå'}\n`;
                            });
                        }
                        
                        if (parsedData.objective) {
                            analysis += `   - objective.description: "${parsedData.objective.description || ''}" ${parsedData.objective.description?.trim() ? '‚úÖ' : '‚ùå'}\n`;
                        }
                        
                        analysis += `   - experience array: ${Array.isArray(parsedData.experience) ? parsedData.experience.length + ' items' : 'n√£o √© array'} ${parsedData.experience?.length > 0 ? '‚úÖ' : '‚ùå'}\n`;
                        analysis += `   - education array: ${Array.isArray(parsedData.education) ? parsedData.education.length + ' items' : 'n√£o √© array'} ${parsedData.education?.length > 0 ? '‚úÖ' : '‚ùå'}\n`;
                        analysis += `   - skills array: ${Array.isArray(parsedData.skills) ? parsedData.skills.length + ' items' : 'n√£o √© array'} ${parsedData.skills?.length > 0 ? '‚úÖ' : '‚ùå'}\n`;
                        
                        if (hasAnyData) {
                            resultDiv.innerHTML = '<div class="validation-result valid">‚úÖ VALIDA√á√ÉO PASSOU - Dados parciais encontrados!</div>';
                            analysis += 'üéâ RESULTADO: Valida√ß√£o deveria PASSAR (dados parciais)\n';
                        } else {
                            resultDiv.innerHTML = '<div class="validation-result invalid">‚ùå VALIDA√á√ÉO FALHOU - Nenhum dado v√°lido encontrado!</div>';
                            analysis += 'üí• RESULTADO: Valida√ß√£o FALHOU\n';
                        }
                    }
                    
                    analysisDiv.innerHTML = '<pre>' + analysis + '</pre>';
                } else {
                    resultDiv.innerHTML = '<div class="validation-result invalid">‚ùå VALIDA√á√ÉO FALHOU - Nenhum dado no localStorage!</div>';
                    analysisDiv.innerHTML = '<pre>üí• RESULTADO: Nenhum dado encontrado no localStorage</pre>';
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erro ao verificar localStorage:', error);
                resultDiv.innerHTML = '<div class="validation-result invalid">‚ùå ERRO - ' + error.message + '</div>';
                analysisDiv.innerHTML = '<pre>üí• ERRO: ' + error.message + '</pre>';
            }
        }
        
        function clearData() {
            localStorage.removeItem('cvgratis-curriculum');
            alert('Dados limpos!');
            checkValidation();
        }
        
        function populateTestData() {
            const testData = {
                personalInfo: {
                    name: 'Ana Victoria Reis',
                    email: 'avreis@gmail.com',
                    phone: '31995652414',
                    address: 'Belo Horizonte, MG',
                    linkedin: '',
                    website: ''
                },
                objective: {
                    description: 'Especialista em administrativo com comprovada expertise em controle, finan√ßas.',
                    keywords: ''
                },
                experience: [],
                education: [],
                skills: [],
                languages: [],
                courses: [],
                projects: [],
                achievements: []
            };
            
            localStorage.setItem('cvgratis-curriculum', JSON.stringify(testData));
            alert('Dados de teste populados!');
            checkValidation();
        }
        
        // Verificar automaticamente ao carregar
        window.onload = function() {
            checkValidation();
        };
    </script>
</body>
</html>